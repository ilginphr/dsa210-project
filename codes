# Re-import and generate the final version of the code using uploaded Excel file
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from scipy.stats import pearsonr
import statsmodels.api as sm

# Load the provided Excel file
file_path = "/mnt/data/WeightStudy-ilginpuhur.xlsx"
data = pd.read_excel(file_path)

# Parse the date for time series analysis
data['Parsed Date'] = pd.to_datetime(data['Date'].str.extract(r'(\d+ \w+ \d{4})')[0], format='%d %B %Y')

# Fill missing values if any
data.fillna(data.mean(numeric_only=True), inplace=True)

# Save full Python script as .py file
code = f"""
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from scipy.stats import pearsonr
import statsmodels.api as sm

# Load Data
file_path = "WeightStudy-ilginpuhur.xlsx"
data = pd.read_excel(file_path)

# Parse date
data['Parsed Date'] = pd.to_datetime(data['Date'].str.extract(r'(\\d+ \\w+ \\d{{4}})')[0], format='%d %B %Y')

# Fill missing values
data.fillna(data.mean(numeric_only=True), inplace=True)

# Correlation Matrix
plt.figure(figsize=(10, 8))
sns.heatmap(data[['Caloric Intake', 'Burned Calories', 'Water Consumption (L)', 'Weight (kg)']].corr(),
            annot=True, cmap='coolwarm', linewidths=0.5)
plt.title('Correlation Matrix')
plt.tight_layout()
plt.show()

# Scatter Plots
plt.figure(figsize=(8, 6))
sns.scatterplot(x='Caloric Intake', y='Weight (kg)', data=data)
plt.title('Caloric Intake vs Weight')
plt.tight_layout()
plt.show()

plt.figure(figsize=(8, 6))
sns.scatterplot(x='Water Consumption (L)', y='Weight (kg)', data=data)
plt.title('Water Consumption vs Weight')
plt.tight_layout()
plt.show()

# Box Plot: Weight
plt.figure(figsize=(6, 5))
sns.boxplot(y=data['Weight (kg)'])
plt.title('Weight Distribution')
plt.tight_layout()
plt.show()

# Histogram: Caloric Intake
plt.figure(figsize=(8, 6))
sns.histplot(data['Caloric Intake'], bins=10, kde=True)
plt.title('Distribution of Caloric Intake')
plt.tight_layout()
plt.show()

# Time Series: Weight
plt.figure(figsize=(10, 5))
sns.lineplot(x='Parsed Date', y='Weight (kg)', data=data, marker='o')
plt.title('Weight Over Time')
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()

# Hypothesis Testing
corr_cal, p_cal = pearsonr(data['Caloric Intake'], data['Weight (kg)'])
corr_water, p_water = pearsonr(data['Water Consumption (L)'], data['Weight (kg)'])

print("Caloric Intake vs Weight — Correlation:", round(corr_cal, 3), "P-value:", round(p_cal, 4))
print("Water Consumption vs Weight — Correlation:", round(corr_water, 3), "P-value:", round(p_water, 4))

# Regression: Caloric Intake → Weight
X = sm.add_constant(data['Caloric Intake'])
y = data['Weight (kg)']
model = sm.OLS(y, X).fit()
print(model.summary())
"""

# Save to a Python file
code_path = "/mnt/data/weight_study_analysis.py"
with open(code_path, "w") as f:
    f.write(code)

code_path
